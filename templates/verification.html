{% extends 'base.html' %}

{% block head %}
<title>SparkEd - Email Verification</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<style>
/* Email Verification Specific Styles */
.verification-container {
  max-width: 500px;
  width: 100%;
  padding: 3rem 2rem;
  margin: 0 auto;
  text-align: center;
}

.verification-icon {
  width: 80px;
  height: 80px;
  background: linear-gradient(135deg, #F7567C 0%, #d6456a 100%);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 2rem;
  animation: pulse 2s infinite;
}

.verification-icon svg {
  width: 40px;
  height: 40px;
  fill: white;
}

.verification-title {
  color: #F7567C;
  font-size: 2rem;
  font-weight: 600;
  margin-bottom: 1rem;
  animation: fadeInUp 0.8s ease-out;
}

.verification-subtitle {
  color: #666;
  font-size: 1.1rem;
  margin-bottom: 2rem;
  line-height: 1.6;
  animation: fadeInUp 0.8s ease-out 0.2s both;
}

.verification-email {
  background: rgba(247, 86, 124, 0.1);
  border: 2px solid #F7567C;
  border-radius: 0.5rem;
  padding: 1rem;
  margin: 1.5rem 0;
  font-weight: 600;
  color: #F7567C;
  animation: fadeInUp 0.8s ease-out 0.4s both;
}

.verification-actions {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin: 2rem 0;
  animation: fadeInUp 0.8s ease-out 0.6s both;
}

.verification-button {
  padding: 1rem 2rem;
  border-radius: 0.5rem;
  font-weight: 600;
  font-size: 1.1rem;
  cursor: pointer;
  transition: all 0.3s ease;
  border: none;
  text-decoration: none;
  display: inline-block;
}

.verification-button.primary {
  background: linear-gradient(135deg, #F7567C 0%, #d6456a 100%);
  color: white;
}

.verification-button.primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(247, 86, 124, 0.3);
}

.verification-button.secondary {
  background: transparent;
  color: #F7567C;
  border: 2px solid #F7567C;
}

.verification-button.secondary:hover {
  background: rgba(247, 86, 124, 0.1);
  transform: translateY(-2px);
}

.verification-info {
  background: rgba(255, 250, 227, 0.6);
  border: 1px solid rgba(247, 86, 124, 0.2);
  border-radius: 0.5rem;
  padding: 1.5rem;
  margin: 2rem 0;
  animation: fadeInUp 0.8s ease-out 0.8s both;
}

.verification-info h3 {
  color: #F7567C;
  margin-bottom: 1rem;
  font-size: 1.2rem;
}

.verification-info ul {
  text-align: left;
  color: #666;
  line-height: 1.8;
}

.verification-info li {
  margin-bottom: 0.5rem;
  padding-left: 1rem;
  position: relative;
}

.verification-info li:before {
  content: "✓";
  color: #F7567C;
  font-weight: bold;
  position: absolute;
  left: 0;
}

.verification-timer {
  background: rgba(247, 86, 124, 0.1);
  border-radius: 0.5rem;
  padding: 1rem;
  margin: 1.5rem 0;
  animation: fadeInUp 0.8s ease-out 1s both;
}

.verification-timer span {
  color: #F7567C;
  font-weight: 600;
  font-size: 1.2rem;
}

.verification-resend {
  margin-top: 2rem;
  animation: fadeInUp 0.8s ease-out 1.2s both;
}

.verification-resend p {
  color: #666;
  margin-bottom: 1rem;
}

.verification-resend a {
  color: #F7567C;
  text-decoration: none;
  font-weight: 600;
}

.verification-resend a:hover {
  text-decoration: underline;
}

.verification-error {
  background: rgba(220, 53, 69, 0.1);
  border: 1px solid #dc3545;
  border-radius: 0.5rem;
  padding: 1rem;
  margin: 1rem 0;
  color: #dc3545;
  animation: fadeInUp 0.8s ease-out;
}

.verification-success {
  background: rgba(40, 167, 69, 0.1);
  border: 1px solid #28a745;
  border-radius: 0.5rem;
  padding: 1rem;
  margin: 1rem 0;
  color: #28a745;
  animation: fadeInUp 0.8s ease-out;
}

.verification-loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(247, 86, 124, 0.3);
  border-radius: 50%;
  border-top-color: #F7567C;
  animation: spin 1s ease-in-out infinite;
  margin-right: 0.5rem;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.verification-code-input {
  display: flex;
  gap: 0.5rem;
  justify-content: center;
  margin: 2rem 0;
  animation: fadeInUp 0.8s ease-out 0.6s both;
}

.verification-code-input input {
  width: 50px;
  height: 60px;
  text-align: center;
  font-size: 1.5rem;
  font-weight: 600;
  border: 2px solid #F7567C;
  border-radius: 0.5rem;
  background: rgba(252, 252, 252, 0.95);
  color: #F7567C;
  transition: all 0.3s ease;
}

.verification-code-input input:focus {
  outline: none;
  box-shadow: 0 0 0 3px rgba(247, 86, 124, 0.2);
  transform: scale(1.05);
}

.verification-code-input input.filled {
  background: rgba(247, 86, 124, 0.1);
}

@media screen and (max-width: 575px) {
  .verification-container {
    padding: 2rem 1rem;
  }
  
  .verification-title {
    font-size: 1.5rem;
  }
  
  .verification-code-input {
    gap: 0.25rem;
  }
  
  .verification-code-input input {
    width: 40px;
    height: 50px;
    font-size: 1.2rem;
  }
}
</style>
{% endblock %}

{% block body %}
<div class="login verification-bg">
   <div class="container verification-container">
      <!-- Verification Icon -->
      <div class="verification-icon">
         <svg viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
         </svg>
      </div>

      <!-- Main Content -->
      <h1 class="verification-title">Verify Your Email</h1>
      <p class="verification-subtitle">
         We've sent a verification code to your email address. Please enter the code below to complete your registration.
      </p>

      <!-- Email Display -->
      <div class="verification-email" id="user-email">
         user@example.com
      </div>

      <!-- Verification Code Input -->
      <div class="verification-code-input">
         <input type="text" maxlength="1" class="code-input" data-index="0">
         <input type="text" maxlength="1" class="code-input" data-index="1">
         <input type="text" maxlength="1" class="code-input" data-index="2">
         <input type="text" maxlength="1" class="code-input" data-index="3">
         <input type="text" maxlength="1" class="code-input" data-index="4">
         <input type="text" maxlength="1" class="code-input" data-index="5">
      </div>

      <!-- Verification Actions -->
      <div class="verification-actions">
         <button type="button" class="verification-button primary" id="verify-btn">
            <span class="verification-loading" style="display: none;"></span>
            Verify Email
         </button>
         <button type="button" class="verification-button secondary" id="resend-btn">
            Resend Code
         </button>
      </div>

      <!-- Timer -->
      <div class="verification-timer" id="timer-container">
         <p>Code expires in: <span id="timer">05:00</span></p>
      </div>

      <!-- Information Box -->
      <div class="verification-info">
         <h3>Why verify your email?</h3>
         <ul>
            <li>Secure your account and protect your personal information</li>
            <li>Receive important updates about your SparkEd account</li>
            <li>Reset your password if you forget it</li>
            <li>Access exclusive features and content</li>
         </ul>
      </div>

      <!-- Resend Section -->
      <div class="verification-resend">
         <p>Didn't receive the code?</p>
         <a href="#" id="resend-link">Click here to resend</a>
      </div>

      <!-- Error/Success Messages -->
      <div class="verification-error" id="error-message" style="display: none;">
         Invalid verification code. Please try again.
      </div>

      <div class="verification-success" id="success-message" style="display: none;">
         Email verified successfully! Redirecting to login...
      </div>

      <!-- Back to Login -->
      <p class="login__register">
         <a href="/login">← Back to Login</a>
      </p>
   </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const codeInputs = document.querySelectorAll('.code-input');
    const verifyBtn = document.getElementById('verify-btn');
    const resendBtn = document.getElementById('resend-btn');
    const resendLink = document.getElementById('resend-link');
    const errorMessage = document.getElementById('error-message');
    const successMessage = document.getElementById('success-message');
    const timerElement = document.getElementById('timer');
    const loadingSpinner = document.querySelector('.verification-loading');

    let timeLeft = 300; // 5 minutes in seconds
    let timerInterval;

    // Auto-focus and move to next input
    codeInputs.forEach((input, index) => {
        input.addEventListener('input', function(e) {
            const value = e.target.value;
            if (value.length === 1) {
                input.classList.add('filled');
                if (index < codeInputs.length - 1) {
                    codeInputs[index + 1].focus();
                }
            } else {
                input.classList.remove('filled');
            }
        });

        input.addEventListener('keydown', function(e) {
            if (e.key === 'Backspace' && !e.target.value && index > 0) {
                codeInputs[index - 1].focus();
            }
        });
    });

    // Verify button click
    verifyBtn.addEventListener('click', function() {
        const code = Array.from(codeInputs).map(input => input.value).join('');
        
        if (code.length !== 6) {
            showError('Please enter the complete 6-digit code.');
            return;
        }

        // Show loading
        loadingSpinner.style.display = 'inline-block';
        verifyBtn.disabled = true;

        // Simulate verification (replace with actual API call)
        setTimeout(() => {
            if (code === '123456') { // Demo code
                showSuccess();
            } else {
                showError('Invalid verification code. Please try again.');
                clearInputs();
            }
            loadingSpinner.style.display = 'none';
            verifyBtn.disabled = false;
        }, 2000);
    });

    // Resend functionality
    function resendCode() {
        clearInputs();
        timeLeft = 300;
        startTimer();
        showSuccess('New verification code sent to your email!');
    }

    resendBtn.addEventListener('click', resendCode);
    resendLink.addEventListener('click', function(e) {
        e.preventDefault();
        resendCode();
    });

    // Timer functionality
    function startTimer() {
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeLeft--;
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                timerElement.textContent = '00:00';
                showError('Verification code has expired. Please request a new one.');
            }
        }, 1000);
    }

    // Utility functions
    function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = 'block';
        successMessage.style.display = 'none';
        setTimeout(() => {
            errorMessage.style.display = 'none';
        }, 5000);
    }

    function showSuccess(message = 'Email verified successfully! Redirecting to login...') {
        successMessage.textContent = message;
        successMessage.style.display = 'block';
        errorMessage.style.display = 'none';
        
        if (message.includes('Redirecting')) {
            setTimeout(() => {
                window.location.href = '/login';
            }, 2000);
        }
    }

    function clearInputs() {
        codeInputs.forEach(input => {
            input.value = '';
            input.classList.remove('filled');
        });
        codeInputs[0].focus();
    }

    // Initialize
    startTimer();
    codeInputs[0].focus();

    // Set demo email (replace with actual user email)
    document.getElementById('user-email').textContent = 'user@example.com';
});
</script>
{% endblock %}
